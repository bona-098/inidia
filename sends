onAppointmentFormOpening: function (e) {
    const form = e.form;

    function validateBooking() {
        let selectedRoom = form.getEditor("ghm_room_id")?.option("value");                        
        let guestCount = (form.getEditor("guest")?.option("value") || []).length;
        let familyCount = (form.getEditor("family")?.option("value") || []).length;
        let employeeCount = (form.getEditor("employee")?.option("value") || []).length;
        let totalGuests = guestCount + familyCount + employeeCount;
        let room = roomsWithLocations.find(room => room.id === selectedRoom);
        let roomCapacity = room?.roomOccupancy || 0;       
        let remainingCapacity = roomCapacity - totalGuests;

        console.log("Room Capacity:", roomCapacity);                 
        console.log("Total Guests:", totalGuests);                 
        console.log("Remaining Capacity:", remainingCapacity); 

        return { roomCapacity, totalGuests, remainingCapacity };
    }

    let { roomCapacity, totalGuests, remainingCapacity } = validateBooking();

    form.option('items', [
        {
            label: { text: 'Room' },
            editorType: 'dxSelectBox',
            dataField: 'ghm_room_id',
            helpText: `Occupancy: ${roomCapacity} | Booked: ${totalGuests} | Remaining: ${remainingCapacity}`,
            editorOptions: {
                readOnly: false,
                dataSource: roomsWithLocations,
                displayExpr: function (item) {
                    if (!item) return "";
                    return `${item.location} | ${item.text}`;
                },
                valueExpr: 'id',
                value: null,
                onValueChanged: function () {
                    let updatedData = validateBooking();
                    form.itemOption("ghm_room_id", "helpText", 
                        `Occupancy: ${updatedData.roomCapacity} | Booked: ${updatedData.totalGuests} | Remaining: ${updatedData.remainingCapacity}`);
                }
            }
        }
    ]);
}
